import{a7 as E,a8 as g,a9 as p,aa as I,ab as T,ac as d,ad as R,ae as f,af as m,ag as C,ah as k,ai as N,aj as w,E as s,ak as u,al as l}from"./vendor-8276265d.js";/*! @azure/msal-browser v3.3.0 2023-10-20 */function v(i){return i.status!==void 0}/*! @azure/msal-browser v3.3.0 2023-10-20 */var c;(function(i){i.USER_INTERACTION_REQUIRED="USER_INTERACTION_REQUIRED",i.USER_CANCEL="USER_CANCEL",i.NO_NETWORK="NO_NETWORK",i.TRANSIENT_ERROR="TRANSIENT_ERROR",i.PERSISTENT_ERROR="PERSISTENT_ERROR",i.DISABLED="DISABLED",i.ACCOUNT_UNAVAILABLE="ACCOUNT_UNAVAILABLE",i.NESTED_APP_AUTH_UNAVAILABLE="NESTED_APP_AUTH_UNAVAILABLE"})(c||(c={}));/*! @azure/msal-browser v3.3.0 2023-10-20 */class U{constructor(e,t,o,r){this.clientId=e,this.clientCapabilities=t,this.crypto=o,this.logger=r}toNaaSilentTokenRequest(e){var r;let t;return e.extraQueryParameters===void 0?t=new Map:t=new Map(Object.entries(e.extraQueryParameters)),{userObjectId:(r=e.account)==null?void 0:r.homeAccountId,clientId:this.clientId,authority:e.authority,scope:e.scopes.join(" "),correlationId:e.correlationId!==void 0?e.correlationId:this.crypto.createNewGuid(),prompt:e.prompt!==void 0?e.prompt:"",claims:e.claims!==void 0?e.claims:"",authenticationScheme:e.authenticationScheme!==void 0?e.authenticationScheme:"",clientCapabilities:this.clientCapabilities,extraParameters:t}}toNaaTokenRequest(e){var r;let t;return e.extraQueryParameters===void 0?t=new Map:t=new Map(Object.entries(e.extraQueryParameters)),{userObjectId:(r=e.account)==null?void 0:r.homeAccountId,clientId:this.clientId,authority:e.authority,scope:e.scopes.join(" "),correlationId:e.correlationId!==void 0?e.correlationId:"",prompt:e.prompt!==void 0?e.prompt:"",nonce:e.nonce!==void 0?e.nonce:"",claims:e.claims!==void 0?e.claims:"",state:e.state!==void 0?e.state:"",authenticationScheme:e.authenticationScheme!==void 0?e.authenticationScheme:"",clientCapabilities:void 0,extraParameters:t}}fromNaaTokenResponse(e,t){const o=new Date(E.nowSeconds()+(t.expires_in||0)*1e3),r=this.fromNaaAccountInfo(t.account);return{authority:t.account.environment,uniqueId:t.account.homeAccountId,tenantId:t.account.tenantId,scopes:t.scope.split(" "),account:this.fromNaaAccountInfo(t.account),idToken:t.id_token!==void 0?t.id_token:"",idTokenClaims:r.idTokenClaims!==void 0?r.idTokenClaims:{},accessToken:t.access_token,fromCache:!0,expiresOn:o,tokenType:e.authenticationScheme!==void 0?e.authenticationScheme:"Bearer",correlationId:e.correlationId,requestId:"",extExpiresOn:o,state:t.state}}fromNaaAccountInfo(e){let t;return e.idToken!==void 0?t=g(e.idToken,this.crypto.base64Decode):t=void 0,{homeAccountId:e.homeAccountId,environment:e.environment,tenantId:e.tenantId,username:e.username,localAccountId:e.localAccountId,name:e.name,idToken:e.idToken,idTokenClaims:t}}fromBridgeError(e){if(v(e))switch(e.status){case c.USER_CANCEL:return new d(C);case c.NO_NETWORK:return new d(m);case c.ACCOUNT_UNAVAILABLE:return new d(f);case c.DISABLED:return new d(R);case c.NESTED_APP_AUTH_UNAVAILABLE:return new d(e.code,e.description);case c.TRANSIENT_ERROR:case c.PERSISTENT_ERROR:return new T(e.code,e.description);case c.USER_INTERACTION_REQUIRED:return new I(e.code,e.description);default:return new p(e.code,e.description)}else return new p("unknown_error","An unknown error occurred")}}/*! @azure/msal-browser v3.3.0 2023-10-20 */const h={unsupportedMethod:{code:"unsupported_method",desc:"The PKCE code challenge and verifier could not be generated."}};class n extends p{constructor(e,t){super(e,t),Object.setPrototypeOf(this,n.prototype),this.name="NestedAppAuthError"}static createUnsupportedError(){return new n(h.unsupportedMethod.code,h.unsupportedMethod.desc)}}/*! @azure/msal-browser v3.3.0 2023-10-20 */class A{constructor(e){this.operatingContext=e;const t=this.operatingContext.getBridgeProxy();if(t!==void 0)this.bridgeProxy=t;else throw new Error("unexpected: bridgeProxy is undefined");this.config=e.getConfig(),this.logger=this.operatingContext.getLogger(),this.performanceClient=this.config.telemetry.client,this.browserCrypto=e.isBrowserEnvironment()?new k(this.logger,this.performanceClient):N,this.eventHandler=new w(this.logger,this.browserCrypto),this.nestedAppAuthAdapter=new U(this.config.auth.clientId,this.config.auth.clientCapabilities,this.browserCrypto,this.logger)}getBrowserStorage(){throw n.createUnsupportedError()}getEventHandler(){return this.eventHandler}static async createController(e){const t=new A(e);return Promise.resolve(t)}initialize(){return Promise.resolve()}async acquireTokenInteractive(e){this.eventHandler.emitEvent(s.ACQUIRE_TOKEN_START,u.Popup,e);const t=this.performanceClient.startMeasurement(l.AcquireTokenPopup,e.correlationId);t==null||t.add({nestedAppAuthRequest:!0});try{const o=this.nestedAppAuthAdapter.toNaaTokenRequest(e),r=await this.bridgeProxy.getTokenInteractive(o),a=this.nestedAppAuthAdapter.fromNaaTokenResponse(o,r);return this.operatingContext.setActiveAccount(a.account),this.eventHandler.emitEvent(s.ACQUIRE_TOKEN_SUCCESS,u.Popup,a),t.add({accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length}),t.end({success:!0,requestId:a.requestId}),a}catch(o){const r=this.nestedAppAuthAdapter.fromBridgeError(o);throw this.eventHandler.emitEvent(s.ACQUIRE_TOKEN_FAILURE,u.Popup,null,o),t.end({errorCode:r.errorCode,subErrorCode:r.subError,success:!1}),r}}async acquireTokenSilentInternal(e){this.eventHandler.emitEvent(s.ACQUIRE_TOKEN_START,u.Silent,e);const t=this.performanceClient.startMeasurement(l.SsoSilent,e.correlationId);t==null||t.increment({visibilityChangeCount:0}),t==null||t.add({nestedAppAuthRequest:!0});try{const o=this.nestedAppAuthAdapter.toNaaSilentTokenRequest(e),r=await this.bridgeProxy.getTokenSilent(o),a=this.nestedAppAuthAdapter.fromNaaTokenResponse(o,r);return this.operatingContext.setActiveAccount(a.account),this.eventHandler.emitEvent(s.ACQUIRE_TOKEN_SUCCESS,u.Silent,a),t==null||t.add({accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length}),t==null||t.end({success:!0,requestId:a.requestId}),a}catch(o){const r=this.nestedAppAuthAdapter.fromBridgeError(o);throw this.eventHandler.emitEvent(s.ACQUIRE_TOKEN_FAILURE,u.Silent,null,o),t==null||t.end({errorCode:r.errorCode,subErrorCode:r.subError,success:!1}),r}}async acquireTokenPopup(e){return this.acquireTokenInteractive(e)}acquireTokenRedirect(e){throw n.createUnsupportedError()}async acquireTokenSilent(e){return this.acquireTokenSilentInternal(e)}acquireTokenByCode(e){throw n.createUnsupportedError()}acquireTokenNative(e,t,o){throw n.createUnsupportedError()}acquireTokenByRefreshToken(e,t){throw n.createUnsupportedError()}addEventCallback(e){return this.eventHandler.addEventCallback(e)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){throw n.createUnsupportedError()}removePerformanceCallback(e){throw n.createUnsupportedError()}enableAccountStorageEvents(){throw n.createUnsupportedError()}disableAccountStorageEvents(){throw n.createUnsupportedError()}getAccount(e){throw n.createUnsupportedError()}getAccountByHomeId(e){const t=this.operatingContext.getActiveAccount();return t!==void 0&&t.homeAccountId===e?this.nestedAppAuthAdapter.fromNaaAccountInfo(t):null}getAccountByLocalId(e){const t=this.operatingContext.getActiveAccount();return t!==void 0&&t.localAccountId===e?this.nestedAppAuthAdapter.fromNaaAccountInfo(t):null}getAccountByUsername(e){const t=this.operatingContext.getActiveAccount();return t!==void 0&&t.username===e?this.nestedAppAuthAdapter.fromNaaAccountInfo(t):null}getAllAccounts(){const e=this.operatingContext.getActiveAccount();return e!==void 0?[this.nestedAppAuthAdapter.fromNaaAccountInfo(e)]:[]}handleRedirectPromise(e){throw n.createUnsupportedError()}loginPopup(e){if(e!==void 0)return this.acquireTokenInteractive(e);throw n.createUnsupportedError()}loginRedirect(e){throw n.createUnsupportedError()}logout(e){throw n.createUnsupportedError()}logoutRedirect(e){throw n.createUnsupportedError()}logoutPopup(e){throw n.createUnsupportedError()}ssoSilent(e){return this.acquireTokenSilentInternal(e)}getTokenCache(){throw n.createUnsupportedError()}getLogger(){return this.logger}setLogger(e){this.logger=e}setActiveAccount(e){this.logger.warning("nestedAppAuth does not support setActiveAccount")}getActiveAccount(){const e=this.operatingContext.getActiveAccount();return e!==void 0?this.nestedAppAuthAdapter.fromNaaAccountInfo(e):null}initializeWrapperLibrary(e,t){}setNavigationClient(e){this.logger.warning("setNavigationClient is not supported in nested app auth")}getConfiguration(){return this.config}isBrowserEnv(){return this.operatingContext.isBrowserEnvironment()}getBrowserCrypto(){return this.browserCrypto}getPerformanceClient(){throw n.createUnsupportedError()}getRedirectResponse(){throw n.createUnsupportedError()}preflightBrowserEnvironmentCheck(e,t){throw n.createUnsupportedError()}async clearCache(e){throw n.createUnsupportedError()}async hydrateCache(e,t){throw n.createUnsupportedError()}}export{A as NestedAppAuthController};
